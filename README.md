# Pluma

A self-hosted markdown editor with live preview, document encryption, and dark/light theme support.

## Quick Start

### Prerequisites

- Docker and Docker Compose installed on your system
- Linux, macOS, or Windows with WSL2

### Installation

1. Clone this repository:

   ```bash
   git clone <your-repo-url>
   cd pluma
   ```

2. Run the setup script:

   ```bash
   chmod +x setup.sh
   ./setup.sh
   ```

   This will:
   - Generate secure secrets for JWT and encryption
   - Build Docker containers
   - Start the application

3. Access the application:
   - Frontend: http://localhost:3000
   - Backend API: http://localhost:3001

### Manual Setup

If you prefer to set up manually:

1. Generate secrets:

   ```bash
   chmod +x setup-secrets.sh
   ./setup-secrets.sh
   ```

2. Build and start containers:

   ```bash
   docker-compose up -d --build
   ```

3. View logs:
   ```bash
   docker-compose logs -f
   ```

## Configuration

### Docker Secrets

The application uses Docker Secrets for secure credential management:

- `jwt_secret`: Used for JWT token signing (64 hex characters)
- `encryption_key`: Used for document encryption (64 hex characters)

These are automatically generated by `setup-secrets.sh` and stored in the `secrets/` directory.

**⚠️ IMPORTANT:** Never commit the `secrets/` directory to version control. Back up these files securely - losing the encryption key means losing access to encrypted documents.

### Environment Variables

For development without Docker, you can use `.env` file:

```env
JWT_SECRET=your-jwt-secret-here
ENCRYPTION_KEY=your-encryption-key-here
PORT=3001
```

## Backup and Restore

### Backup Your Data

Create a backup of your documents:

```bash
docker run --rm \
  -v pluma_pluma-data:/data \
  -v $(pwd)/backups:/backup \
  alpine tar czf /backup/pluma-backup-$(date +%Y%m%d-%H%M%S).tar.gz /data
```

### Restore from Backup

```bash
docker run --rm \
  -v pluma_pluma-data:/data \
  -v $(pwd)/backups:/backup \
  alpine sh -c "cd /data && tar xzf /backup/pluma-backup-YYYYMMDD-HHMMSS.tar.gz --strip 1"
```

**Don't forget to also backup your `secrets/` directory!**

## Development

### Local Development

1. Install dependencies:

   ```bash
   pnpm install
   ```

2. Set up environment variables in `.env`

3. Start backend:

   ```bash
   cd backend
   pnpm dev
   ```

4. Start frontend (in another terminal):
   ```bash
   pnpm dev
   ```

### Lost Encryption Key

If you lose the encryption key, documents cannot be decrypted. Always maintain secure backups of:

- `secrets/encryption_key.txt`
- `secrets/jwt_secret.txt`
- Document data volume

### Regenerating Secrets

⚠️ Warning: This will invalidate all existing encrypted documents and sessions.

```bash
rm -rf secrets/
./setup-secrets.sh
docker-compose down
docker-compose up -d --build
```

## Roadmap

See [FUTURE_FEATURES.md](FUTURE_FEATURES.md) for planned features and improvements.

## Contributing

Contributions are welcome! Please open an issue or submit a pull request.

## License

AGPL-3.0 License. See [LICENSE](LICENSE) for details.
